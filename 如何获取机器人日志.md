# 如何获取机器人日志到本地

## 快速方法：使用 downloadLogs 脚本

### 1. 下载日志到本地
```bash
cd Make/Common
./downloadLogs 10.0.70.6
```

日志会自动下载到：
```
Config/Logs/YYYY-MM-DD-HH-MM/机器人名称/
```

### 2. 下载后删除机器人上的日志（节省空间）
```bash
./downloadLogs -d 10.0.70.6
```

### 3. 只删除机器人上的日志（不下载）
```bash
./downloadLogs -D 10.0.70.6
```

### 4. 同时从多个机器人下载
```bash
./downloadLogs 10.0.70.6 10.0.70.7 10.0.70.8
```

## 日志文件位置

### 机器人上
```
/home/nao/logs/YYYYMMDD_HHMMSS/Team70/team_comm_p1.txt
```

### 下载到本地后
```
Config/Logs/YYYY-MM-DD-HH-MM/机器人名称/team_comm_p1.txt
Config/Logs/YYYY-MM-DD-HH-MM/机器人名称/其他日志文件.log
```

## 完整工作流程

### 1. 部署机器人
```bash
./deploy -r 1 10.0.70.6 -nc -t 70 -s Default -m 70 -w SPL_A -v 100 -b
```

### 2. 运行测试/比赛
机器人会自动在 `/home/nao/logs/` 目录下生成日志文件

### 3. 下载日志到本地
```bash
cd Make/Common
./downloadLogs -d 10.0.70.6
```

### 4. 查看日志
```bash
cd ../../Config/Logs
ls -lt  # 查看最新的日志目录
cd 最新目录/机器人名称/
cat team_comm_p1.txt
```

## 其他下载方法

### 方法 1：手动 SCP
```bash
# 下载所有日志
scp -r nao@10.0.70.6:/home/nao/logs/* ./Config/Logs/

# 下载特定日志
scp nao@10.0.70.6:/home/nao/logs/20260127_223000/Team70/team_comm_p1.txt ./
```

### 方法 2：使用 rsync（更快，支持断点续传）
```bash
rsync -avz --progress nao@10.0.70.6:/home/nao/logs/ ./Config/Logs/
```

## 日志文件说明

### team_comm_p*.txt
团队通信日志，包含：
- 发送的消息内容
- 接收的队友消息
- 机器人位置、球位置
- 角色、行为状态
- 消息预算使用情况

### 其他 .log 文件
系统日志，包含：
- bhuman 进程日志
- 错误和警告信息
- 模块运行状态

## 自动化脚本示例

创建一个自动下载脚本 `auto_download_logs.sh`：

```bash
#!/bin/bash
# 自动从所有机器人下载日志

ROBOTS=(
  "10.0.70.6"
  "10.0.70.7"
  "10.0.70.8"
  "10.0.70.9"
  "10.0.70.10"
)

cd Make/Common

echo "开始下载日志..."
./downloadLogs -d "${ROBOTS[@]}"

echo "日志已下载到 Config/Logs/"
ls -lt ../../Config/Logs/ | head -5
```

使用方法：
```bash
chmod +x auto_download_logs.sh
./auto_download_logs.sh
```

## 注意事项

1. **确保机器人可访问**：下载前确保能 SSH 到机器人
   ```bash
   ssh nao@10.0.70.6 "echo 连接成功"
   ```

2. **停止 bhuman 进程**：downloadLogs 脚本会自动停止和重启 bhuman 进程

3. **磁盘空间**：
   - 机器人存储空间有限，定期下载并删除日志
   - 本地 Config/Logs 目录也会占用空间，定期清理

4. **日志时间戳**：
   - 机器人上的日志使用机器人本地时间
   - 下载到本地的目录名使用下载时的本地时间

5. **权限问题**：如果遇到权限错误，检查 SSH 配置和密钥

## 查看日志的工具

### 1. 命令行查看
```bash
# 查看完整日志
cat team_comm_p1.txt

# 查看最后 50 行
tail -n 50 team_comm_p1.txt

# 实时查看（如果日志还在写入）
tail -f team_comm_p1.txt

# 搜索特定内容
grep "发送" team_comm_p1.txt
grep "接收.*2号" team_comm_p1.txt
```

### 2. 文本编辑器
```bash
# 使用 VS Code
code team_comm_p1.txt

# 使用 vim
vim team_comm_p1.txt

# 使用 less（支持搜索和翻页）
less team_comm_p1.txt
```

### 3. 日志分析脚本
可以编写 Python 脚本分析日志：
```python
# analyze_logs.py
import re

with open('team_comm_p1.txt', 'r', encoding='utf-8') as f:
    content = f.read()
    
    # 统计发送和接收的消息数量
    sent = len(re.findall(r'\[发送\]', content))
    received = len(re.findall(r'\[接收\]', content))
    
    print(f"发送消息: {sent}")
    print(f"接收消息: {received}")
```
