# 日志可视化界面使用说明

## 功能概述

系统会在每场比赛结束后，自动在每个队伍文件夹下生成一个 `view_logs.html` 可视化界面文件，该文件会自动加载该队伍所有机器人的日志。

## 文件结构

```
Config/Sim_Logs/
└── 20250128_143025/          # 比赛时间戳
    ├── Team5/                # B-Human队
    │   ├── team_comm_p1.txt  # 1号机器人日志
    │   ├── team_comm_p2.txt  # 2号机器人日志
    │   ├── team_comm_p3.txt  # 3号机器人日志
    │   ├── team_comm_p4.txt  # 4号机器人日志
    │   ├── team_comm_p5.txt  # 5号机器人日志
    │   └── view_logs.html    # ✨ 自动生成的可视化界面
    └── Team70/               # 对手队
        ├── team_comm_p1.txt
        ├── team_comm_p2.txt
        ├── team_comm_p3.txt
        ├── team_comm_p4.txt
        ├── team_comm_p5.txt
        └── view_logs.html    # ✨ 自动生成的可视化界面
```

## 使用方法

### ⚠️ 重要提示：浏览器安全限制

由于浏览器的安全策略，直接双击HTML文件打开时，无法加载本地日志文件。**必须使用本地HTTP服务器**。

### 方法1：使用启动脚本（最简单，推荐）
```bash
./start_log_viewer.sh
```
- 自动找到最新比赛
- 选择要查看的队伍
- 自动启动HTTP服务器
- 自动在浏览器中打开
- 按 Ctrl+C 停止服务器

### 方法2：手动启动HTTP服务器
```bash
# 进入队伍目录
cd Config/Sim_Logs/20250128_143025/Team5/

# 启动Python HTTP服务器
python3 -m http.server 8000

# 在浏览器中打开
# http://localhost:8000/view_logs.html
```

### 方法3：使用其他HTTP服务器
```bash
# 使用 Node.js 的 http-server
npm install -g http-server
cd Config/Sim_Logs/20250128_143025/Team5/
http-server -p 8000

# 使用 PHP 内置服务器
cd Config/Sim_Logs/20250128_143025/Team5/
php -S localhost:8000
```

## 界面功能

### 1. 自动加载
- 打开界面后，会自动加载该队伍所有机器人（1-5号）的日志
- 无需手动上传文件

### 2. 统计信息
界面顶部显示：
- **总消息数**：所有发送和接收的消息总数
- **发送消息**：该队伍发送的消息数量
- **接收消息**：该队伍接收的消息数量
- **机器人数量**：参与通信的机器人数量

### 3. 筛选功能
- **搜索关键词**：输入任意关键词搜索日志内容
- **消息类型**：筛选"全部"、"仅发送"或"仅接收"
- **机器人编号**：筛选特定机器人的日志

### 4. 日志详情
每条日志显示：
- 📤/📥 消息类型（发送/接收）
- ⏱️ 时间戳
- 🤖 机器人编号
- 📍 机器人位置和朝向
- ⚽ 球的位置和可见度
- 👤 机器人角色
- 🎯 传球目标和行走目标
- 💰 消息预算剩余（仅发送消息）

## 自动生成机制

### 触发条件
当任意机器人首次创建日志文件时，系统会检查该队伍文件夹下是否已存在 `view_logs.html`：
- 如果不存在，自动生成
- 如果已存在，跳过生成（避免重复）

### 生成时机
- SimRobot 仿真开始时
- 真实机器人启动时
- 每场比赛只生成一次

## 优势

✅ **零配置**：无需手动创建或配置，自动生成
✅ **自动加载**：打开即可查看，无需上传文件
✅ **独立文件**：每场比赛、每个队伍都有独立的可视化界面
✅ **离线使用**：不依赖网络，纯本地HTML文件
✅ **实时筛选**：支持多种筛选条件，快速定位问题
✅ **美观界面**：现代化设计，易于阅读和分析

## 注意事项

1. **必须使用HTTP服务器**：
   - ⚠️ 由于浏览器安全策略，不能直接双击HTML文件打开
   - ✅ 必须使用 `./start_log_viewer.sh` 或手动启动HTTP服务器
   - ✅ 推荐使用提供的 `start_log_viewer.sh` 脚本，最简单方便

2. **Python要求**：
   - 需要安装 Python 3
   - 检查是否安装：`python3 --version`
   - Ubuntu/Debian安装：`sudo apt install python3`

3. **端口占用**：
   - 默认使用8000端口
   - 如果端口被占用，可以修改脚本中的端口号
   - 或者先关闭占用8000端口的程序

4. **文件路径**：
   - 确保 `view_logs.html` 和日志文件在同一目录下
   - 不要移动或重命名日志文件

5. **日志更新**：
   - 如果比赛还在进行中，刷新浏览器页面即可看到最新日志
   - 日志文件是实时写入的

## 故障排除

### 问题1：打开后显示"正在加载日志..."或"没有找到匹配的日志"
**原因**：浏览器安全策略限制本地文件访问
**解决**：
1. **使用启动脚本（推荐）**：
   ```bash
   ./start_log_viewer.sh
   ```
2. **手动启动HTTP服务器**：
   ```bash
   cd Config/Sim_Logs/20250128_143025/Team5/
   python3 -m http.server 8000
   # 浏览器打开 http://localhost:8000/view_logs.html
   ```
3. **检查浏览器控制台**：
   - 按 F12 打开开发者工具
   - 查看 Console 标签页的错误信息
   - 如果看到 CORS 或 fetch 错误，说明必须使用HTTP服务器

### 问题2：没有自动生成 view_logs.html
**原因**：可能是文件权限问题或路径错误
**解决**：
- 检查 `Config/Sim_Logs/` 目录是否存在
- 检查是否有写入权限
- 查看 SimRobot 控制台输出的错误信息

### 问题3：只显示部分机器人的日志
**原因**：某些机器人可能还没有生成日志文件
**解决**：
- 这是正常现象，只有参与通信的机器人才会生成日志
- 刷新页面查看是否有更新

## 技术细节

- **文件格式**：纯HTML + JavaScript，无需额外依赖
- **数据加载**：使用 Fetch API 异步加载日志文件
- **解析方式**：正则表达式解析日志文本
- **渲染方式**：动态生成DOM元素
- **兼容性**：支持所有现代浏览器（Chrome, Firefox, Safari, Edge）

## 示例截图说明

界面包含：
1. **顶部标题栏**：显示队伍名称和说明
2. **筛选控制栏**：搜索框和下拉菜单
3. **统计卡片区**：4个统计数据卡片
4. **日志列表区**：所有日志条目，发送消息绿色边框，接收消息蓝色边框

每条日志都有悬停效果，点击可查看完整详情。
