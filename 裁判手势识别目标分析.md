# 裁判手势识别目标分析

## 关键发现：识别的是图像右侧区域

### 代码分析（RefereeGestureClassifier.cpp 第58-59行）

```cpp
const unsigned centerX = theCameraImage.width;   // ← 图像宽度（最右边）
const unsigned centerY = (inHeight & 1 ? inHeight + 1 : inHeight) / 2;  // ← 垂直居中
```

### 识别目标位置

```
相机视野（上方相机）：
┌─────────────────────────────────────────┐
│                                         │
│                                         │
│                                    ┌────┤ ← centerX = width（右边缘）
│                                    │ P  │
│                                    │ A  │ ← 提取的 Patch 区域
│                                    │ T  │
│                                    │ C  │
│                                    │ H  │
│                                    └────┤
│                                         │
│                                         │
└─────────────────────────────────────────┘
        ← 机器人前方                裁判方向 →
```

### 为什么是图像右侧？

**原因：机器人的头部会转向裁判方向**

1. **行为控制逻辑**（HandleRefereeSignal.cpp）：
   ```cpp
   // 如果需要，机器人会转身朝向裁判
   state(turnToReferee) {
       WalkToPose({.target = {rotation_to_referee}});
   }
   
   // 然后头部看向裁判
   state(lookAtReferee) {
       LookAtPoint({.target = {refereeOffsetRelative.x(), refereeOffsetRelative.y(), lookAtHeight}});
   }
   ```

2. **裁判位置**（固定在中线边线外）：
   ```cpp
   const Vector2f refereeOnField(
       theFieldDimensions.xPosHalfwayLine,  // 中线
       (theFieldDimensions.yPosLeftTouchline + theFieldDimensions.yPosLeftFieldBorder) / 2.f
   );
   ```

3. **相机朝向**：
   - 机器人转身后，上方相机朝向裁判
   - 裁判应该出现在相机视野的**右侧**（因为相机安装位置和角度）

### 提取的 Patch 大小

#### Kick-in 时：
- **输入大小**：动态计算（根据距离）
  ```cpp
  inHeight = getSizeByDistance(refereeHeight=2400mm, distance);
  inWidth = inHeight;  // 正方形
  ```
- **输出大小**：256×256 像素（固定）

#### Standby 时：
- **输入大小**：256×200 像素（固定）
- **输出大小**：256×200 像素（矩形，宽度更窄）

### 识别的具体目标

根据代码和配置，模型识别的是：

1. **裁判的上半身区域**
   - 高度：约 2.4 米（refereeHeight = 2400mm）
   - 包含：头部、躯干、手臂

2. **红色手套的位置和姿态**
   - Kick-in Left：左手举起（从机器人视角看）
   - Kick-in Right：右手举起
   - Ready：双手举起

3. **Patch 覆盖范围**
   ```
   距离 3米时：
   - 实际高度：约 2.4 米
   - 实际宽度：约 2.4 米（kick-in）或 1.9 米（standby）
   
   距离 6米时：
   - 实际高度：约 4.8 米
   - 实际宽度：约 4.8 米（kick-in）或 3.8 米（standby）
   ```

### 为什么 Standby 的 Patch 更窄？

**Standby 手势（Ready）**：
- 双手向上举起
- 手势主要在**垂直方向**
- 不需要太宽的视野
- 200 像素宽度足够

**Kick-in 手势**：
- 单手向左或向右指
- 手势在**水平方向**延伸
- 需要更宽的视野捕捉手臂方向
- 256 像素宽度（正方形）

### 调试方法

可以通过以下方式查看实际提取的 Patch：

```cpp
SEND_DEBUG_IMAGE("module:RefereeGestureClassifier:patch", img);
```

在 SimRobot 中启用：
```
debug images:module:RefereeGestureClassifier:patch
```

这样可以看到神经网络实际"看到"的图像内容。

### 总结

**识别目标：图像右侧的裁判上半身区域**
- 位置：图像右边缘，垂直居中
- 大小：根据距离动态调整（kick-in）或固定（standby）
- 内容：裁判的头部、躯干、手臂（包括红色手套）
- 目的：识别红色手套的位置和姿态，判断手势类型
